RFC: Postgres Data Model
========================

::

              __     __
             /  \~~~/  \
       ,----(     oo    )
      /      \__     __/
     /|         (\  |(
    ^ \   /___\  /\ |
       |__|   |__|-"


* I'd like to discuss and agree on an initial schema with you.
  Feel free to change this file as much as you want.

* After I/we create the table definitions I'm thinking about using my
  existing python code to parse ebuilds and fill up the db. Once that is done
  I can share a dump with you so we can get started with the web app quicker.

Relations
=========

tree
----

An ebuild repository/overlay. Let's use the name 'repo' for plain git/svn/cvs
repos?

We should do validation against
http://git.overlays.gentoo.org/gitweb/?p=proj/repositories-xml-format.git .

+------------------------+-----------------------------------------------------+
| id                     | integer pk                                          |
+------------------------+-----------------------------------------------------+
| name                   | text                                                |
+------------------------+-----------------------------------------------------+
| description            | text                                                |
+------------------------+-----------------------------------------------------+
| homepage               | text                                                |
+------------------------+-----------------------------------------------------+
| owner name             | text                                                |
+------------------------+-----------------------------------------------------+
| owner email            | text                                                |
+------------------------+-----------------------------------------------------+
| owner type             | person/project                                      |
+------------------------+-----------------------------------------------------+
| source urls            | [(type, url)]                                       |
|                        | type is (bzr/cvs/darcs/git/mercurial/rsync/svn/tar) |
+------------------------+-----------------------------------------------------+
| feed urls              | [text]                                              |
+------------------------+-----------------------------------------------------+
| popularity             | integer (calculated by us)                          |
+------------------------+-----------------------------------------------------+
| priority               | integer                                             |
+------------------------+-----------------------------------------------------+
| quality                | core/stable/testing/experimental/graveyard          |
+------------------------+-----------------------------------------------------+
| status                 | official/unofficial                                 |
+------------------------+-----------------------------------------------------+
| last sync time         | timestamp                                           |
+------------------------+-----------------------------------------------------+
| last sync attempt time | timestamp                                           |
+------------------------+-----------------------------------------------------+
| mtime                  | timestamp                                           |
+------------------------+-----------------------------------------------------+

category
--------

Validate against ``/usr/portage/metadata/dtd/metadata.dtd``.

Category (``c``) = tree (``t``) + category name (``cn``).

Let's duplicate categories across trees? (As opposed to all trees sharing a set
of common categories.)

+-------------+------------+
| id          | integer pk |
+-------------+------------+
| tree        | integer fk |
+-------------+------------+
| name        | text       |
+-------------+------------+
| description | text       |
+-------------+------------+
| mtime       | timestamp  |
+-------------+------------+

Key: (tree, name).

package
-------

Validate against ``/usr/portage/metadata/dtd/metadata.dtd``.

Package (``p``) = category (``c``) + package name (``pn``)?

+-----------------------+---------------------------+
| id                    | integer pk                |
+-----------------------+---------------------------+
| category              | integer fk                |
+-----------------------+---------------------------+
| name                  | text                      |
+-----------------------+---------------------------+
| description           | text                      |
+-----------------------+---------------------------+
| long_description      | text                      |
+-----------------------+---------------------------+
| herd                  | integer fk                |
+-----------------------+---------------------------+
| maintainer_email      | text                      |
+-----------------------+---------------------------+
| maintainer_name       | text                      |
+-----------------------+---------------------------+
| natural_name          | text                      |
+-----------------------+---------------------------+
| changelog             | ?                         |
+-----------------------+---------------------------+
| use_flag_descriptions | [(use_flag, description)] |
+-----------------------+---------------------------+
| upstream              | ?                         |
+-----------------------+---------------------------+
| mtime                 | timestamp                 |
+-----------------------+---------------------------+

ebuild
------

ebuild (e) = package (p) + version + (v)

+-----------------+----------------------------------------------------+
| id              | integer pk                                         |
+-----------------+----------------------------------------------------+
| package         | integer fk                                         |
+-----------------+----------------------------------------------------+
| version         | text                                               |
+-----------------+----------------------------------------------------+
| description     | text                                               |
+-----------------+----------------------------------------------------+
| keywords        | [text]                                             |
+-----------------+----------------------------------------------------+
| eapi            | integer/text?                                      |
+-----------------+----------------------------------------------------+
| homepage        | [text]                                             |
+-----------------+----------------------------------------------------+
| slot            | text                                               |
+-----------------+----------------------------------------------------+
| license         | text                                               |
+-----------------+----------------------------------------------------+
| version_index   | integer (used to 'sort' ebuilds by their version)  |
+-----------------+----------------------------------------------------+
| iuse            | [text]                                             |
+-----------------+----------------------------------------------------+
| depend          | [text] (I've got a fun idea for depend+rdepend :-) |
+-----------------+----------------------------------------------------+
| rdepend         | [text]                                             |
+-----------------+----------------------------------------------------+
| source          | text                                               |
+-----------------+----------------------------------------------------+
| source_filepath | text                                               |
+-----------------+----------------------------------------------------+
| mtime           | timestamp                                          |
+-----------------+----------------------------------------------------+

Key: (package, version)
